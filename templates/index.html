<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cure Health Bot</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      min-height: 100vh;
      color: #111827;
      display: flex;
      justify-content: center;
      padding: 10px;
    }
    .container {
      width: 100%;
      max-width: 1200px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.08);
      border-radius: 16px;
      overflow: hidden;
    }
    header {
      background: linear-gradient(135deg, #2d6cdf 0%, #6b46c1 100%);
      color: white;
      padding: 20px;
      text-align: center;
    }
    header h1 { font-size: clamp(20px, 5vw, 28px); font-weight: 800; margin-bottom: 6px; }
    header p { margin: 0; opacity: 0.95; font-size: clamp(12px, 3vw, 16px); }
    .config-section {
      background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
      padding: 15px;
      color: white;
    }
    .config-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }
    .config-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .config-group label { font-weight: 600; font-size: 14px; }
    .config-group input, .config-group select {
      padding: 12px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.1);
      color: white;
      font-size: 16px; /* Prevents zoom on iOS */
    }
    .config-group input::placeholder { color: rgba(255,255,255,0.6); }
    .provider-tabs { 
      display: flex; 
      gap: 0; 
      margin-bottom: 15px; 
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    .provider-tab {
      padding: 12px 20px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      touch-action: manipulation;
    }
    .provider-tab.active { background: rgba(255,255,255,0.2); border-bottom: 2px solid #4facfe; }
    #llmStatus {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      padding: 15px;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .status-info { display: flex; gap: 12px; align-items: center; flex: 1; min-width: 200px; }
    .status-indicator { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
    .status-loading { background: #ff9800; box-shadow: 0 0 8px rgba(255,152,0,0.6); animation: pulse 1.5s infinite; }
    .status-connected { background: #22c55e; box-shadow: 0 0 8px rgba(34,197,94,0.6); }
    .status-disconnected { background: #ef4444; box-shadow: 0 0 8px rgba(239,68,68,0.6); }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    .model-selector { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .model-selector label { font-weight: 600; opacity: 0.95; white-space: nowrap; }
    .model-selector select {
      padding: 8px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(255,255,255,0.12);
      color: white;
      min-width: 150px;
      font-size: 14px;
    }
    .model-selector option { background: #374151; color: white; font-size: 13px; }
    .debug-info {
      background: rgba(0,0,0,0.08);
      color: white;
      padding: 8px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-height: 120px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #4facfe rgba(255,255,255,0.1);
      width: 100%;
      display: none;
      word-break: break-all;
    }
    .debug-toggle, .btn-small {
      padding: 6px 10px;
      border-radius: 12px;
      background: rgba(255,255,255,0.12);
      color: white;
      border: 1px solid rgba(255,255,255,0.18);
      cursor: pointer;
      font-size: 13px;
      touch-action: manipulation;
    }
    .tabs {
      display: flex;
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      gap: 0;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    .tab {
      padding: 15px 10px;
      min-width: 100px;
      text-align: center;
      font-weight: 700;
      cursor: pointer;
      border-right: 1px solid rgba(255,255,255,0.5);
      transition: all 0.25s ease;
      font-size: 12px;
      white-space: nowrap;
      touch-action: manipulation;
    }
    .tab.active {
      background: linear-gradient(135deg, rgba(102,126,234,0.12), rgba(118,75,162,0.12));
      color: #2d6cdf;
      transform: translateY(-2px);
    }
    .tab-content { display: none; padding: 0; background: #fff; }
    .tab-content.active { display: block; }
    .chat-section {
      display: flex;
      flex-direction: column;
      height: 60vh;
      min-height: 400px;
      max-height: 600px;
      overflow: hidden;
    }
    .chat-controls {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      padding: 15px;
      background: linear-gradient(135deg, #fff7ed, #ffedd5);
      align-items: center;
      flex-wrap: wrap;
    }
    .control-group { display: flex; gap: 10px; align-items: center; }
    .btn {
      padding: 10px 16px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: 700;
      touch-action: manipulation;
      font-size: 14px;
    }
    .btn-secondary { background: linear-gradient(135deg, #ffecd2, #fcb69f); color: #111827; }
    .export-dropdown { position: relative; display: inline-block; }
    .export-menu {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 8px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
      z-index: 1000;
      min-width: 150px;
      border: 1px solid #e5e7eb;
    }
    .export-menu.show { display: block; }
    .export-option {
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.2s;
      border-bottom: 1px solid #f3f4f6;
      font-weight: 600;
      color: #374151;
      touch-action: manipulation;
    }
    .export-option:hover { background: #f8fafc; }
    .export-option:last-child { border-bottom: none; }
    .chatBox {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      scrollbar-width: thin;
      scrollbar-color: #667eea #f5f7fa;
      -webkit-overflow-scrolling: touch;
    }
    .chatBox::-webkit-scrollbar { width: 8px; }
    .chatBox::-webkit-scrollbar-track { background: #f5f7fa; border-radius: 4px; }
    .chatBox::-webkit-scrollbar-thumb { background: #667eea; border-radius: 4px; }
    .message { 
      margin-bottom: 15px; 
      max-width: 85%; 
      animation: messageSlide 0.35s ease-out;
      word-wrap: break-word;
    }
    @keyframes messageSlide { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: none; } }
    .user-message {
      margin-left: auto;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 12px 15px;
      border-radius: 18px 18px 4px 18px;
      font-size: 14px;
    }
    .bot-message {
      margin-right: auto;
      background: white;
      padding: 12px 15px;
      border-radius: 18px 18px 18px 4px;
      border-left: 4px solid #667eea;
      box-shadow: 0 6px 22px rgba(0,0,0,0.04);
      font-size: 14px;
      line-height: 1.5;
    }
    .input-container {
      display: flex;
      gap: 10px;
      padding: 15px;
      background: white;
      align-items: center;
    }
    .chatInput {
      flex: 1;
      padding: 14px 15px;
      border-radius: 20px;
      border: 2px solid #e6eefc;
      font-size: 16px; /* Prevents zoom on iOS */
      outline: none;
      background: #f8fafc;
    }
    .chatInput:focus { box-shadow: 0 0 0 6px rgba(102,126,234,0.06); border-color: #667eea; background: white; }
    .sendBtn {
      padding: 14px 20px;
      border-radius: 20px;
      font-weight: 700;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      touch-action: manipulation;
      font-size: 14px;
    }
    .quick-questions {
      padding: 15px;
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    }
    .questions-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .quick-question {
      background: white;
      padding: 15px;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(0,0,0,0.04);
      font-weight: 600;
      text-align: center;
      transition: transform 0.2s ease;
      touch-action: manipulation;
      font-size: 14px;
    }
    .quick-question:hover { transform: translateY(-2px); }
    .disclaimer, .general-conditions {
      padding: 15px;
      margin: 15px;
      border-radius: 12px;
      font-size: 14px;
    }
    .disclaimer {
      background: linear-gradient(135deg, #fff1f2, #ffe4e6);
      border-left: 4px solid #f97316;
    }
    .general-conditions {
      background: linear-gradient(135deg, #e0f2fe, #bae6fd);
      border-left: 4px solid #0284c7;
    }
    .thinking { opacity: 0.7; font-style: italic; }
    .error-message {
      background: #fee2e2;
      color: #dc2626;
      padding: 12px 15px;
      border-radius: 18px 18px 18px 4px;
      border-left: 4px solid #dc2626;
      margin-bottom: 15px;
      max-width: 85%;
      font-size: 14px;
    }

    /* Enhanced Mobile Responsiveness */
    @media (max-width: 768px) {
      body { padding: 5px; }
      .container { border-radius: 12px; }
      header { padding: 15px; }
      .config-section { padding: 10px; }
      .chat-section { height: 50vh; min-height: 350px; }
      .chatBox { padding: 15px; }
      .input-container { padding: 10px; gap: 8px; }
      .quick-questions { padding: 10px; }
      .questions-grid { grid-template-columns: 1fr; gap: 8px; }
      .tab { padding: 12px 8px; font-size: 11px; min-width: 80px; }
      .model-selector { flex-direction: column; align-items: flex-start; gap: 8px; }
      .model-selector select { min-width: 100%; }
      #llmStatus { flex-direction: column; align-items: flex-start; }
      .status-info { min-width: 100%; }
      .chat-controls { flex-direction: column; gap: 8px; }
      .control-group { width: 100%; justify-content: center; }
      .message { max-width: 95%; }
    }

    @media (max-width: 480px) {
      .chat-section { height: 45vh; min-height: 300px; }
      .quick-question { padding: 12px; font-size: 13px; }
      .btn, .sendBtn { padding: 12px 16px; font-size: 13px; }
      .chatInput { padding: 12px; }
    }

    @media (min-width: 769px) {
      .config-grid { grid-template-columns: 1fr 1fr; }
      .questions-grid { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Cure Health Bot</h1>
      <p>Your AI-powered health companion with 300+ models</p>
    </header>

    <div class="config-section">
      <div class="provider-tabs">
        <div class="provider-tab active" data-provider="openrouter">OpenRouter</div>
        <div class="provider-tab" data-provider="ollama">Ollama</div>
      </div>
      <div id="openrouter-config" class="provider-config">
        <div class="config-grid">
          <div class="config-group">
            <label for="openrouterKey">OpenRouter API Key</label>
            <input type="password" id="openrouterKey" placeholder="sk-or-v1-...">
          </div>
          <div class="config-group">
            <label for="openrouterUrl">OpenRouter URL</label>
            <input type="text" id="openrouterUrl" value="https://openrouter.ai/api/v1/chat/completions">
          </div>
        </div>
      </div>
      <div id="ollama-config" class="provider-config" style="display: none;">
        <div class="config-grid">
          <div class="config-group">
            <label for="ollamaUrl">Ollama Server URL</label>
            <input type="text" id="ollamaUrl" value="http://localhost:11434/api/chat">
          </div>
          <div class="config-group">
            <label>Connection Status</label>
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
              <span id="ollamaStatus">Not connected</span>
              <button class="btn-small" id="testOllamaBtn">Test Connection</button>
            </div>
          </div>
        </div>
      </div>
      <div style="display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap;">
        <button class="btn-small" id="loadModelsBtn">Load Models</button>
        <button class="btn-small" id="saveConfigBtn">Save Config</button>
      </div>
    </div>

    <div id="llmStatus">
      <div class="status-info">
        <span id="statusIndicator" class="status-indicator status-disconnected"></span>
        <div>
          <div id="statusText" style="font-weight: 700;">Not Connected</div>
          <div style="font-size: 12px; opacity: 0.95;" id="statusSub">Configure your API settings</div>
        </div>
        <button class="debug-toggle" id="debugToggleBtn">Debug Info</button>
      </div>
      <div class="model-selector">
        <label for="modelSelect">AI Model</label>
        <select id="modelSelect" aria-label="Select AI model">
          <option value="">Configure provider first</option>
        </select>
        <button class="btn-small" id="refreshModelsBtn">Refresh</button>
      </div>
      <div id="debugInfo" class="debug-info">
        <div id="debugLog">Configure your provider to get started...</div>
      </div>
    </div>

    <div class="tabs" role="tablist" aria-label="Sections">
      <div class="tab active" data-tab="general">General Health</div>
      <div class="tab" data-tab="diabetes">Diabetes Care</div>
      <div class="tab" data-tab="heart">Heart Health</div>
      <div class="tab" data-tab="mental">Mental Wellness</div>
      <div class="tab" data-tab="respiratory">Respiratory</div>
      <div class="tab" data-tab="women">Women's Health</div>
      <div class="tab" data-tab="elderly">Elderly Care</div>
      <div class="tab" data-tab="pediatric">Pediatric Health</div>
    </div>

    <!-- General Health Tab -->
    <div id="general" class="tab-content active">
      <div class="chat-controls">
        <div class="control-group">
          <button class="btn btn-secondary" id="clearChatBtn">Clear Chat</button>
        </div>
        <div class="control-group">
          <div class="export-dropdown">
            <button class="btn btn-secondary" id="exportBtn">Export Chat ‚ñº</button>
            <div class="export-menu" id="exportMenu">
              <div class="export-option" data-format="pdf">üìÑ Export as PDF</div>
              <div class="export-option" data-format="word">üìù Export as Word</div>
              <div class="export-option" data-format="txt">üìã Export as Text</div>
            </div>
          </div>
        </div>
      </div>
      <div class="chat-section">
        <div class="chatBox" id="generalChatBox" aria-live="polite"></div>
        <div class="input-container">
          <input class="chatInput" id="generalInput" placeholder="Ask about general health..." maxlength="1000">
          <button class="sendBtn" id="generalSend">Send</button>
        </div>
      </div>
      <div class="quick-questions">
        <h3 style="text-align: center; margin-bottom: 14px;">Quick Health Questions</h3>
        <div class="questions-grid">
          <div class="quick-question">What are common cold symptoms?</div>
          <div class="quick-question">How to boost immune system naturally?</div>
          <div class="quick-question">What foods are healthiest to eat daily?</div>
          <div class="quick-question">How much water should I drink daily?</div>
        </div>
      </div>
    </div>

    <!-- Other tabs remain similar but with mobile-optimized layout -->
    <!-- Diabetes Tab -->
    <div id="diabetes" class="tab-content">
      <div class="chat-controls">
        <div class="control-group">
          <button class="btn btn-secondary" id="clearChatBtnD">Clear Chat</button>
        </div>
        <div class="control-group">
          <div class="export-dropdown">
            <button class="btn btn-secondary" id="exportBtnD">Export Chat ‚ñº</button>
            <div class="export-menu" id="exportMenuD">
              <div class="export-option" data-format="pdf" data-tab="diabetes">üìÑ Export as PDF</div>
              <div class="export-option" data-format="word" data-tab="diabetes">üìù Export as Word</div>
              <div class="export-option" data-format="txt" data-tab="diabetes">üìã Export as Text</div>
            </div>
          </div>
        </div>
      </div>
      <div class="chat-section">
        <div class="chatBox" id="diabetesChatBox" aria-live="polite"></div>
        <div class="input-container">
          <input class="chatInput" id="diabetesInput" placeholder="Ask about diabetes management..." maxlength="1000">
          <button class="sendBtn" id="diabetesSend">Send</button>
        </div>
      </div>
      <div class="quick-questions">
        <h3 style="text-align: center; margin-bottom: 14px;">Diabetes Care Questions</h3>
        <div class="questions-grid">
          <div class="quick-question">What foods should diabetics avoid?</div>
          <div class="quick-question">How to monitor blood sugar properly?</div>
          <div class="quick-question">Best exercises for diabetes management</div>
          <div class="quick-question">What are signs of low blood sugar?</div>
        </div>
      </div>
    </div>

    <!-- Heart Health Tab -->
    <div id="heart" class="tab-content">
      <div class="chat-controls">
        <div class="control-group">
          <button class="btn btn-secondary" id="clearChatBtnH">Clear Chat</button>
        </div>
        <div class="control-group">
          <div class="export-dropdown">
            <button class="btn btn-secondary" id="exportBtnH">Export Chat ‚ñº</button>
            <div class="export-menu" id="exportMenuH">
              <div class="export-option" data-format="pdf" data-tab="heart">üìÑ Export as PDF</div>
              <div class="export-option" data-format="word" data-tab="heart">üìù Export as Word</div>
              <div class="export-option" data-format="txt" data-tab="heart">üìã Export as Text</div>
            </div>
          </div>
        </div>
      </div>
      <div class="chat-section">
        <div class="chatBox" id="heartChatBox" aria-live="polite"></div>
        <div class="input-container">
          <input class="chatInput" id="heartInput" placeholder="Ask about heart health..." maxlength="1000">
          <button class="sendBtn" id="heartSend">Send</button>
        </div>
      </div>
      <div class="quick-questions">
        <h3 style="text-align: center; margin-bottom: 14px;">Heart Health Questions</h3>
        <div class="questions-grid">
          <div class="quick-question">What is normal blood pressure range?</div>
          <div class="quick-question">How to control cholesterol naturally?</div>
          <div class="quick-question">What exercises are best for heart health?</div>
          <div class="quick-question">What are the best heart-healthy foods?</div>
        </div>
      </div>
    </div>

    <!-- Mental Wellness Tab -->
    <div id="mental" class="tab-content">
      <div class="chat-controls">
        <div class="control-group">
          <button class="btn btn-secondary" id="clearChatBtnM">Clear Chat</button>
        </div>
        <div class="control-group">
          <div class="export-dropdown">
            <button class="btn btn-secondary" id="exportBtnM">Export Chat ‚ñº</button>
            <div class="export-menu" id="exportMenuM">
              <div class="export-option" data-format="pdf" data-tab="mental">üìÑ Export as PDF</div>
              <div class="export-option" data-format="word" data-tab="mental">üìù Export as Word</div>
              <div class="export-option" data-format="txt" data-tab="mental">üìã Export as Text</div>
            </div>
          </div>
        </div>
      </div>
      <div class="chat-section">
        <div class="chatBox" id="mentalChatBox" aria-live="polite"></div>
        <div class="input-container">
          <input class="chatInput" id="mentalInput" placeholder="Ask about mental wellness..." maxlength="1000">
          <button class="sendBtn" id="mentalSend">Send</button>
        </div>
      </div>
      <div class="quick-questions">
        <h3 style="text-align: center; margin-bottom: 14px;">Mental Wellness Questions</h3>
        <div class="questions-grid">
          <div class="quick-question">How to manage stress effectively?</div>
          <div class="quick-question">Tips for better sleep hygiene</div>
          <div class="quick-question">How to practice mindfulness daily?</div>
          <div class="quick-question">Ways to cope with anxiety</div>
        </div>
      </div>
    </div>

    <!-- Respiratory Health Tab -->
    <div id="respiratory" class="tab-content">
      <div class="chat-controls">
        <div class="control-group">
          <button class="btn btn-secondary" id="clearChatBtnR">Clear Chat</button>
        </div>
        <div class="control-group">
          <div class="export-dropdown">
            <button class="btn btn-secondary" id="exportBtnR">Export Chat ‚ñº</button>
            <div class="export-menu" id="exportMenuR">
              <div class="export-option" data-format="pdf" data-tab="respiratory">üìÑ Export as PDF</div>
              <div class="export-option" data-format="word" data-tab="respiratory">üìù Export as Word</div>
              <div class="export-option" data-format="txt" data-tab="respiratory">üìã Export as Text</div>
            </div>
          </div>
        </div>
      </div>
      <div class="chat-section">
        <div class="chatBox" id="respiratoryChatBox" aria-live="polite"></div>
        <div class="input-container">
          <input class="chatInput" id="respiratoryInput" placeholder="Ask about respiratory health..." maxlength="1000">
          <button class="sendBtn" id="respiratorySend">Send</button>
        </div>
      </div>
      <div class="quick-questions">
        <h3 style="text-align: center; margin-bottom: 14px;">Respiratory Health Questions</h3>
        <div class="questions-grid">
          <div class="quick-question">How to improve lung capacity naturally?</div>
          <div class="quick-question">What are signs of asthma?</div>
          <div class="quick-question">Breathing exercises for better health</div>
          <div class="quick-question">How to prevent respiratory infections?</div>
        </div>
      </div>
    </div>

    <!-- Women's Health Tab -->
    <div id="women" class="tab-content">
      <div class="chat-controls">
        <div class="control-group">
          <button class="btn btn-secondary" id="clearChatBtnW">Clear Chat</button>
        </div>
        <div class="control-group">
          <div class="export-dropdown">
            <button class="btn btn-secondary" id="exportBtnW">Export Chat ‚ñº</button>
            <div class="export-menu" id="exportMenuW">
              <div class="export-option" data-format="pdf" data-tab="women">üìÑ Export as PDF</div>
              <div class="export-option" data-format="word" data-tab="women">üìù Export as Word</div>
              <div class="export-option" data-format="txt" data-tab="women">üìã Export as Text</div>
            </div>
          </div>
        </div>
      </div>
      <div class="chat-section">
        <div class="chatBox" id="womenChatBox" aria-live="polite"></div>
        <div class="input-container">
          <input class="chatInput" id="womenInput" placeholder="Ask about women's health..." maxlength="1000">
          <button class="sendBtn" id="womenSend">Send</button>
        </div>
      </div>
      <div class="quick-questions">
        <h3 style="text-align: center; margin-bottom: 14px;">Women's Health Questions</h3>
        <div class="questions-grid">
          <div class="quick-question">What are common signs of hormonal imbalance?</div>
          <div class="quick-question">How to maintain reproductive health?</div>
          <div class="quick-question">Nutrition during pregnancy</div>
          <div class="quick-question">Managing menopause symptoms naturally</div>
        </div>
      </div>
    </div>

    <!-- Elderly Care Tab -->
    <div id="elderly" class="tab-content">
      <div class="chat-controls">
        <div class="control-group">
          <button class="btn btn-secondary" id="clearChatBtnE">Clear Chat</button>
        </div>
        <div class="control-group">
          <div class="export-dropdown">
            <button class="btn btn-secondary" id="exportBtnE">Export Chat ‚ñº</button>
            <div class="export-menu" id="exportMenuE">
              <div class="export-option" data-format="pdf" data-tab="elderly">üìÑ Export as PDF</div>
              <div class="export-option" data-format="word" data-tab="elderly">üìù Export as Word</div>
              <div class="export-option" data-format="txt" data-tab="elderly">üìã Export as Text</div>
            </div>
          </div>
        </div>
      </div>
      <div class="chat-section">
        <div class="chatBox" id="elderlyChatBox" aria-live="polite"></div>
        <div class="input-container">
          <input class="chatInput" id="elderlyInput" placeholder="Ask about elderly care..." maxlength="1000">
          <button class="sendBtn" id="elderlySend">Send</button>
        </div>
      </div>
      <div class="quick-questions">
        <h3 style="text-align: center; margin-bottom: 14px;">Elderly Care Questions</h3>
        <div class="questions-grid">
          <div class="quick-question">How to prevent falls in elderly?</div>
          <div class="quick-question">Managing multiple medications safely</div>
          <div class="quick-question">Maintaining cognitive health with age</div>
          <div class="quick-question">Nutrition needs for seniors</div>
        </div>
      </div>
    </div>

    <!-- Pediatric Health Tab -->
    <div id="pediatric" class="tab-content">
      <div class="chat-controls">
        <div class="control-group">
          <button class="btn btn-secondary" id="clearChatBtnP">Clear Chat</button>
        </div>
        <div class="control-group">
          <div class="export-dropdown">
            <button class="btn btn-secondary" id="exportBtnP">Export Chat ‚ñº</button>
            <div class="export-menu" id="exportMenuP">
              <div class="export-option" data-format="pdf" data-tab="pediatric">üìÑ Export as PDF</div>
              <div class="export-option" data-format="word" data-tab="pediatric">üìù Export as Word</div>
              <div class="export-option" data-format="txt" data-tab="pediatric">üìã Export as Text</div>
            </div>
          </div>
        </div>
      </div>
      <div class="chat-section">
        <div class="chatBox" id="pediatricChatBox" aria-live="polite"></div>
        <div class="input-container">
          <input class="chatInput" id="pediatricInput" placeholder="Ask about pediatric health..." maxlength="1000">
          <button class="sendBtn" id="pediatricSend">Send</button>
        </div>
      </div>
      <div class="quick-questions">
        <h3 style="text-align: center; margin-bottom: 14px;">Pediatric Health Questions</h3>
        <div class="questions-grid">
          <div class="quick-question">Vaccination schedule for children</div>
          <div class="quick-question">Managing childhood obesity</div>
          <div class="quick-question">When to be concerned about fever?</div>
          <div class="quick-question">Healthy eating habits for kids</div>
        </div>
      </div>
    </div>

    <div class="disclaimer">
      <strong>‚ö†Ô∏è Medical Disclaimer:</strong> This bot provides general health information only and should not replace professional medical advice. Always consult with healthcare professionals for medical concerns.
    </div>
  </div>

  <script>
    // Global variables
    let currentProvider = 'openrouter';
    let conversationHistories = {};
    let isStreaming = false;

    // Initialize conversation histories for all tabs
    const tabs = ['general', 'diabetes', 'heart', 'mental', 'respiratory', 'women', 'elderly', 'pediatric'];
    tabs.forEach(tab => {
      conversationHistories[tab] = [];
    });

    // Utility functions
    function addDebugLog(message) {
      const debugLog = document.getElementById('debugLog');
      const timestamp = new Date().toLocaleTimeString();
      debugLog.innerHTML += `[${timestamp}] ${message}\n`;
      debugLog.scrollTop = debugLog.scrollHeight;
    }

    function updateConnectionStatus(status, message, subMessage = '') {
      const indicator = document.getElementById('statusIndicator');
      const text = document.getElementById('statusText');
      const sub = document.getElementById('statusSub');
      
      indicator.className = `status-indicator status-${status}`;
      text.textContent = message;
      sub.textContent = subMessage;
      
      addDebugLog(`Status: ${status} - ${message}`);
    }

    function saveConfig() {
      const config = {
        provider: currentProvider,
        openrouter: {
          key: document.getElementById('openrouterKey').value,
          url: document.getElementById('openrouterUrl').value
        },
        ollama: {
          url: document.getElementById('ollamaUrl').value
        },
        selectedModel: document.getElementById('modelSelect').value
      };
      localStorage.setItem('curebotConfig', JSON.stringify(config));
      addDebugLog('Configuration saved');
    }

    function loadConfig() {
      const saved = localStorage.getItem('curebotConfig');
      if (saved) {
        const config = JSON.parse(saved);
        currentProvider = config.provider || 'openrouter';
        
        document.getElementById('openrouterKey').value = config.openrouter?.key || '';
        document.getElementById('openrouterUrl').value = config.openrouter?.url || 'https://openrouter.ai/api/v1/chat/completions';
        document.getElementById('ollamaUrl').value = config.ollama?.url || 'http://localhost:11434/api/chat';
        
        // Update provider tabs
        document.querySelectorAll('.provider-tab').forEach(tab => {
          tab.classList.toggle('active', tab.dataset.provider === currentProvider);
        });
        
        // Show correct config section
        document.getElementById('openrouter-config').style.display = currentProvider === 'openrouter' ? 'block' : 'none';
        document.getElementById('ollama-config').style.display = currentProvider === 'ollama' ? 'block' : 'none';
        
        addDebugLog('Configuration loaded');
      }
    }

    // Fixed Ollama connection testing
    async function testOllamaConnection() {
      const url = document.getElementById('ollamaUrl').value;
      const statusElement = document.getElementById('ollamaStatus');
      
      try {
        addDebugLog('Testing Ollama connection...');
        statusElement.textContent = 'Testing...';
        
        // Test if Ollama server is running by checking the API endpoint
        const testUrl = url.replace('/api/chat', '/api/tags');
        
        const response = await fetch(testUrl, {
          method: 'GET',
          headers: {
            'Accept': 'application/json',
          }
        });
        
        if (response.ok) {
          statusElement.textContent = 'Connected ‚úì';
          statusElement.style.color = '#22c55e';
          addDebugLog('Ollama connection successful');
          updateConnectionStatus('connected', 'Ollama Connected', 'Ready to chat');
          return true;
        } else {
          throw new Error(`Server responded with status: ${response.status}`);
        }
      } catch (error) {
        statusElement.textContent = 'Connection failed ‚úó';
        statusElement.style.color = '#ef4444';
        addDebugLog(`Ollama connection failed: ${error.message}`);
        updateConnectionStatus('disconnected', 'Connection Failed', error.message);
        return false;
      }
    }

    // Fixed model loading for both providers
    async function loadModels() {
      const modelSelect = document.getElementById('modelSelect');
      modelSelect.innerHTML = '<option value="">Loading models...</option>';
      
      try {
        updateConnectionStatus('loading', 'Loading Models', 'Please wait...');
        
        if (currentProvider === 'openrouter') {
          const apiKey = document.getElementById('openrouterKey').value;
          if (!apiKey) {
            throw new Error('OpenRouter API key is required');
          }
          
          const response = await fetch('https://openrouter.ai/api/v1/models', {
            headers: {
              'Authorization': `Bearer ${apiKey}`,
              'Content-Type': 'application/json'
            }
          });
          
          if (!response.ok) {
            throw new Error(`Failed to fetch models: ${response.status}`);
          }
          
          const data = await response.json();
          modelSelect.innerHTML = '<option value="">Select a model</option>';
          
          data.data.forEach(model => {
            const option = document.createElement('option');
            option.value = model.id;
            option.textContent = `${model.id} - ${model.pricing?.prompt || '0'}/1K tokens`;
            modelSelect.appendChild(option);
          });
          
          updateConnectionStatus('connected', 'OpenRouter Connected', `${data.data.length} models loaded`);
          addDebugLog(`Loaded ${data.data.length} OpenRouter models`);
          
        } else if (currentProvider === 'ollama') {
          const url = document.getElementById('ollamaUrl').value;
          const modelsUrl = url.replace('/api/chat', '/api/tags');
          
          const response = await fetch(modelsUrl);
          if (!response.ok) {
            throw new Error(`Failed to fetch Ollama models: ${response.status}`);
          }
          
          const data = await response.json();
          modelSelect.innerHTML = '<option value="">Select a model</option>';
          
          if (data.models && data.models.length > 0) {
            data.models.forEach(model => {
              const option = document.createElement('option');
              option.value = model.name;
              option.textContent = `${model.name} (${Math.round(model.size / 1024 / 1024 / 1024 * 100) / 100}GB)`;
              modelSelect.appendChild(option);
            });
            
            updateConnectionStatus('connected', 'Ollama Connected', `${data.models.length} models loaded`);
            addDebugLog(`Loaded ${data.models.length} Ollama models`);
          } else {
            modelSelect.innerHTML = '<option value="">No models found</option>';
            updateConnectionStatus('connected', 'Ollama Connected', 'No models installed');
            addDebugLog('Ollama connected but no models found');
          }
        }
      } catch (error) {
        modelSelect.innerHTML = '<option value="">Failed to load models</option>';
        updateConnectionStatus('disconnected', 'Connection Failed', error.message);
        addDebugLog(`Model loading failed: ${error.message}`);
      }
    }

    // Fixed chat function with proper Ollama API format
    async function sendMessage(tabName, message) {
      const chatBox = document.getElementById(`${tabName}ChatBox`);
      const input = document.getElementById(`${tabName}Input`);
      
      if (isStreaming) {
        addDebugLog('Already processing a message, please wait...');
        return;
      }
      
      if (!message.trim()) return;
      
      const selectedModel = document.getElementById('modelSelect').value;
      if (!selectedModel) {
        addMessage(tabName, 'Please select a model first.', 'error');
        return;
      }
      
      // Add user message
      addMessage(tabName, message, 'user');
      input.value = '';
      
      // Add conversation to history
      conversationHistories[tabName].push({
        role: 'user',
        content: message
      });
      
      // Show thinking indicator
      const thinkingDiv = document.createElement('div');
      thinkingDiv.className = 'message bot-message thinking';
      thinkingDiv.innerHTML = 'Thinking...';
      chatBox.appendChild(thinkingDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
      
      isStreaming = true;
      
      try {
        let response;
        
        if (currentProvider === 'openrouter') {
          const apiKey = document.getElementById('openrouterKey').value;
          const apiUrl = document.getElementById('openrouterUrl').value;
          
          // Add system message for health context
          const messages = [
            {
              role: 'system',
              content: `You are a helpful healthcare assistant focused on ${tabName} health. Provide informative, accurate, and empathetic responses. Always remind users to consult healthcare professionals for serious concerns. Keep responses concise but comprehensive.`
            },
            ...conversationHistories[tabName]
          ];
          
          response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${apiKey}`,
              'Content-Type': 'application/json',
              'HTTP-Referer': window.location.origin,
              'X-Title': 'CureBot Health Assistant'
            },
            body: JSON.stringify({
              model: selectedModel,
              messages: messages,
              temperature: 0.7,
              max_tokens: 1000
            })
          });
          
        } else if (currentProvider === 'ollama') {
          const apiUrl = document.getElementById('ollamaUrl').value;
          
          // Ollama API format
          response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              model: selectedModel,
              messages: [
                {
                  role: 'system',
                  content: `You are a helpful healthcare assistant focused on ${tabName} health. Provide informative, accurate, and empathetic responses. Always remind users to consult healthcare professionals for serious concerns. Keep responses concise but comprehensive.`
                },
                ...conversationHistories[tabName]
              ],
              stream: false
            })
          });
        }
        
        // Remove thinking indicator
        chatBox.removeChild(thinkingDiv);
        
        if (!response.ok) {
          throw new Error(`API request failed: ${response.status} ${response.statusText}`);
        }
        
        const data = await response.json();
        let botResponse = '';
        
        if (currentProvider === 'openrouter') {
          botResponse = data.choices?.[0]?.message?.content || 'No response received';
        } else if (currentProvider === 'ollama') {
          botResponse = data.message?.content || 'No response received';
        }
        
        // Add bot response
        addMessage(tabName, botResponse, 'bot');
        
        // Add to conversation history
        conversationHistories[tabName].push({
          role: 'assistant',
          content: botResponse
        });
        
        addDebugLog(`Message sent successfully via ${currentProvider}`);
        
      } catch (error) {
        // Remove thinking indicator
        if (thinkingDiv.parentNode) {
          chatBox.removeChild(thinkingDiv);
        }
        
        addMessage(tabName, `Error: ${error.message}`, 'error');
        addDebugLog(`Chat error: ${error.message}`);
      } finally {
        isStreaming = false;
      }
    }

    function addMessage(tabName, message, type) {
      const chatBox = document.getElementById(`${tabName}ChatBox`);
      const messageDiv = document.createElement('div');
      
      if (type === 'user') {
        messageDiv.className = 'message user-message';
      } else if (type === 'error') {
        messageDiv.className = 'error-message';
      } else {
        messageDiv.className = 'message bot-message';
      }
      
      messageDiv.innerHTML = message.replace(/\n/g, '<br>');
      chatBox.appendChild(messageDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function clearChat(tabName) {
      const chatBox = document.getElementById(`${tabName}ChatBox`);
      chatBox.innerHTML = '';
      conversationHistories[tabName] = [];
      addDebugLog(`Chat cleared for ${tabName} tab`);
    }

    function exportChat(tabName, format) {
      const history = conversationHistories[tabName];
      if (history.length === 0) {
        alert('No chat history to export');
        return;
      }
      
      let content = `CureBot ${tabName.charAt(0).toUpperCase() + tabName.slice(1)} Health Chat Export\n`;
      content += `Generated on: ${new Date().toLocaleString()}\n\n`;
      
      history.forEach((msg, index) => {
        content += `${msg.role.toUpperCase()}: ${msg.content}\n\n`;
      });
      
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `curebot-${tabName}-chat.${format === 'txt' ? 'txt' : 'txt'}`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      addDebugLog(`Chat exported as ${format} for ${tabName}`);
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      loadConfig();
      
      // Provider tab switching
      document.querySelectorAll('.provider-tab').forEach(tab => {
        tab.addEventListener('click', function() {
          currentProvider = this.dataset.provider;
          
          document.querySelectorAll('.provider-tab').forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          document.getElementById('openrouter-config').style.display = currentProvider === 'openrouter' ? 'block' : 'none';
          document.getElementById('ollama-config').style.display = currentProvider === 'ollama' ? 'block' : 'none';
          
          updateConnectionStatus('disconnected', 'Not Connected', 'Configure your API settings');
          document.getElementById('modelSelect').innerHTML = '<option value="">Configure provider first</option>';
        });
      });
      
      // Health category tab switching
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
          const targetTab = this.dataset.tab;
          
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
          
          this.classList.add('active');
          document.getElementById(targetTab).classList.add('active');
        });
      });
      
      // Configuration buttons
      document.getElementById('testOllamaBtn').addEventListener('click', testOllamaConnection);
      document.getElementById('loadModelsBtn').addEventListener('click', loadModels);
      document.getElementById('saveConfigBtn').addEventListener('click', saveConfig);
      document.getElementById('refreshModelsBtn').addEventListener('click', loadModels);
      
      // Debug toggle
      document.getElementById('debugToggleBtn').addEventListener('click', function() {
        const debugInfo = document.getElementById('debugInfo');
        debugInfo.style.display = debugInfo.style.display === 'block' ? 'none' : 'block';
      });
      
      // Send message handlers for all tabs
      tabs.forEach(tab => {
        const input = document.getElementById(`${tab}Input`);
        const sendBtn = document.getElementById(`${tab}Send`);
        const clearBtn = document.getElementById(`clearChatBtn${tab.charAt(0).toUpperCase()}`);
        
        // Send on button click
        sendBtn.addEventListener('click', () => sendMessage(tab, input.value));
        
        // Send on Enter key
        input.addEventListener('keypress', function(e) {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage(tab, this.value);
          }
        });
        
        // Clear chat
        if (clearBtn) {
          clearBtn.addEventListener('click', () => clearChat(tab));
        }
        
        // Quick questions
        const quickQuestions = document.querySelectorAll(`#${tab} .quick-question`);
        quickQuestions.forEach(question => {
          question.addEventListener('click', function() {
            input.value = this.textContent;
            sendMessage(tab, this.textContent);
          });
        });
        
        // Export functionality
        const exportBtn = document.getElementById(`exportBtn${tab.charAt(0).toUpperCase()}`);
        const exportMenu = document.getElementById(`exportMenu${tab.charAt(0).toUpperCase()}`);
        
        if (exportBtn && exportMenu) {
          exportBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            exportMenu.classList.toggle('show');
          });
          
          exportMenu.addEventListener('click', function(e) {
            if (e.target.classList.contains('export-option')) {
              const format = e.target.dataset.format;
              exportChat(tab, format);
              exportMenu.classList.remove('show');
            }
          });
        }
      });
      
      // Close export menus when clicking outside
      document.addEventListener('click', function() {
        document.querySelectorAll('.export-menu').forEach(menu => {
          menu.classList.remove('show');
        });
      });
      
      // Handle quick questions for general tab (different ID structure)
      const generalQuestions = document.querySelectorAll('#general .quick-question');
      generalQuestions.forEach(question => {
        question.addEventListener('click', function() {
          const input = document.getElementById('generalInput');
          input.value = this.textContent;
          sendMessage('general', this.textContent);
        });
      });
      
      // Export functionality for general tab
      const generalExportBtn = document.getElementById('exportBtn');
      const generalExportMenu = document.getElementById('exportMenu');
      
      if (generalExportBtn && generalExportMenu) {
        generalExportBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          generalExportMenu.classList.toggle('show');
        });
        
        generalExportMenu.addEventListener('click', function(e) {
          if (e.target.classList.contains('export-option')) {
            const format = e.target.dataset.format;
            exportChat('general', format);
            generalExportMenu.classList.remove('show');
          }
        });
      }
      
      addDebugLog('CureBot initialized successfully');
    });
  </script>
</body>
</html>
